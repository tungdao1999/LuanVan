Nguyễn_Hùng_An NguyenHungAn Follow 199 6 14 Published about 10 hours ago 4 min read 18 0 0 Sử_dụng sự_kiện onBackPressed hiệu_quả trong Activity và Fragment Happy New Year Report Hiện_tại việc lắng_nghe sự_kiện back từ device Android chỉ được thực_hiện ở Activity bằng cách override hàm onBackPressed và implement các phương_thức cần_thiết
Vậy còn Fragment thì_sao
Chúng_ta không_thể sử_dụng cùng phương_thức như ở Activity vì đơn_giản là không có hàm đó để_cho chúng_ta override
Vậy làm cách nào để lắng_nghe sự_kiện back từ hệ_thống cách làm hay sử_dụng nhất_là phương_pháp dưới đây requireActivity
onBackPressedDispatcher
addCallbackthis Thực_hiện implement các chức_năng khi có sự_kiện back Cách làm này có_thể lắng_nghe sự_kiện back khi user nhấn nút back trên device tại các Fragment đang trực_tiếp tương_tác với user nhưng ở một_số device có firmware thấp có_thể không có tác_dụng và không_nhận được sự_kiện back
Và nếu Activity chứa Fragment này cùng lắng_nghe sự_kiện onBackPressed thì sẽ dễ dẫn đến xung_đột và code sẽ khó quản_lý
Với những vấn_đề trên ở bài_viết này xin giới_thiệu một phương_pháp lắng_nghe hiệu_quả sự_kiện onBackPressed tránh được một số vấn_đề về thiết_bị xung_đột khi cùng lắng_nghe sự_kiện này
Đầu_tiên chúng_ta có_thể thấy rằng việc code ứng_dụng Andoird hiện_nay thường dựa_trên các mô_hình Framework như MVP MVVM Clean Architect


Chúng_ta đều xây_dựng được các BaseActivity BaseFragment


để implement các đặc_tính chung
Chúng_ta sẽ tạo_ra lớp BaseFragment mà có hàm onBackPressed để lắng_nghe các sự_kiện back khi cần nếu Fragment nào cần xử_lý sự_kiện này chỉ cần override lại
Hàm có nội_dung như dưới đây abstract class BaseFragment Fragment open fun onBackPressed Boolean return false Việc return về một giá_trị Boolean để báo_hiệu cho_biết là Fragment đó có quản_lý sự_kiện onBackPressed hay không
Chúng_ta sẽ thấy được ý_nghĩa của nó ở hàm bên_dưới
Như phần_đầu bài_viết đã nói trong Fragment không có phương_thức onBackPressed để override vậy chúng_ta lắng_nghe sự_kiện này từ đâu
Câu_trả_lời là từ chính Activity chứa các Fragment này
Và sau_đây là cách chúng_ta lắng_nghe sự_kiện back từ Activity và truyền về cho Fragment
override fun onBackPressed try var handled = false 1 supportFragmentManager
fragments
forEach fragment - if fragment is NavHostFragment fragment
childFragmentManager
fragments
forEach childFragment - 2 if childFragment is BaseFragment 3 handled = childFragment
onBackPressed 4 if handled 5 return if
handled 6 super
onBackPressed catch e Exception super
onBackPressed Ta có_thể hiểu được hàm_trên qua thứ_tự thực_hiện các bước như_sau Tạo biến handled để giúp xác_nhận là có Fragment cần xử_lý sự_kiện onBackPressed hay không Chạy lần_lượt qua các Fragment mà Activity này quản_lý Kiểm_tra Fragment đang có có_phải là con của BaseFragment hay không Nếu là con của BaseFragment thì gọi hàm onBackPressed của Fragment
Chính tại dòng này sẽ giúp gọi thực_thi các chức_năng cần_thiết khi user nhấn Back ở Fragment đó
Nếu có override lại hàm onBackPressed trong Fragment thì trả về giá_trị true ngược_lại trả về giá_trị false mặc_định
Nếu Fragment có handle việc xử_lý sự_kiện Back thì không_cần Activity xử_lý nữa return thoát_khỏi hàm điều này tránh phải việc xung_đột khi có nhiều bên cùng lắng_nghe sự_kiện Back
Nếu không có Fragment nào xử_lý sự_kiện Back sử_dụng sự_kiện Back của Activity Dựa_trên việc cài_đặt này sẽ giúp chúng_ta dễ_dàng quản_lý việc nhấn Back từ device giúp tránh được các vấn_đề phát_sinh
Hy_vọng mọi_người có_thể có_nhiều cách hay hơn
Bài_viết đến đây xin kết_thúc back pressed All Rights Reserved Report