httpsvibloasiaptao-data-table-web-app-lay-du-lieu-tu-google-sheets-su-dung-apps-script-gGJALGXViking ramboviking Follow Published Sunday AM min read Tạo data table web app lấy_dữ_liệu từ Google Sheets sử_dụng Apps Script Report Google Sheets là công_cụ tuyệt_vời để lưu_trữ bảng tính trực_tuyến bạn có_thể truy_cập bảng tính bất_kỳ lúc_nào ở bất_kỳ đâu và luôn sẵn_sàng để chia_sẻ với người_khác
Nếu bạn chỉ muốn chia_sẻ một phần của bảng tính tạo một sheet mới và dùng hàm importRange có_thể đã đáp_ứng yêu_cầu của_bạn
Tuy_nhiên nếu bạn muốn cung_cấp một giao_diện trực_quan hơn cho người_dùng để thực_hiện các thao_tác như sort search highlight paging thì bạn có_thể viết web app sử_dụng Apps Script của Google cung_cấp
Bài này gồm_phần
Phần chúng_ta sẽ hiển_thị toàn_bộ dữ_liệu mỗi khi load web app
Phần chúng_ta sẽ tạo chức_năng Search và chỉ hiển_thị đúng_dữ_liệu mà người_dùng yêu_cầu
Lưu_ý bài này dành cho beginner
Hiển_thị data table Để tạo table chúng_ta có_thể sử_dụng JavaScript thuần nhưng mình sử_dụng Data Tables jQuery plug-in để việc tạo table dễ_dàng hơn và có sẵn nhiều chức_năng
Mình tìm table jQuery plug-in trên Google và thấy plug-in này hiện_ra đầu_tiên nên dùng luôn
Nếu bạn_biết plug-in nào hay_ho hơn thì hãy cho mình biết_nhé
Chúng_ta cùng xem qua thành_quả trước_khi bắt_tay vào viết code
Code Apps Script Theo hướng_dẫn của Google chúng_ta cần hàm doGet hoặc doPost có trả về HTML Service object để tạo_giao_diện cho web app
Chúng_ta tách file CSS JavaScript với file HTML theo hướng_dẫn best practices của Google bằng hàm include file Codegsfunction doGete return HtmlServicecreateTemplateFromFile'Indexhtml' evaluatefunction includefilename return HtmlServicecreateHtmlOutputFromFilefilename getContent Indexhtml Trong file HTML chúng_ta sẽ tạo thẻ với idtable để render table sau_khi lấy_dữ_liệu từ file Google Sheets
Các bạn lưu_ý Data Tables jQuery là plug-in của jQuery nên đừng quên chèn link CDN jQuery vào file HTML trước_khi chèn link plug-in
Bây_giờ mình đã biết chèn link file JavaScript cũng phải đúng thứ_tự thì code máy chạy
Hồi đó tự_học nên không có ai dạy về điều này hết Invoice Invoice data from the spreadsheet use Data Table jQuery plug-in to render table Code JavaScript Chúng_ta dùng hàm ready của jQuery để thực_thi một hàm callback khi DOM đã sẵn_sàng
Chúng_ta sẽ sử_dụng class googlescriptrun để chạy hàm Apps Script khi ở client-side Để khởi_tạo DataTable instance thì chúng_ta cần truyền vào columns data và một số option khác các bạn có_thể tham_khảo tại httpsdatatablesnet File JavaScripthtml readyfunction googlescriptrunwithSuccessHandlershowDataTable getAllData function showDataTabledataTable var header [] dataTableheaderforEachitem headerpushtitle item 'table'DataTable data dataTabledata columns header searching false info false Code server- side Ở server-side file Codegs chúng_ta sẽ viết hàm getAllData để trả về dữ_liệu để tạo bảng File Codegsvar ss SpreadsheetAppgetActiveSpreadsheetvar sheet ssgetSheetByName'Invoice'function doGete function includefilename function getAllData var range sheetgetRange sheetgetLastRow- sheetgetLastColumn var values rangegetValues return header getHeaderArr data values function getHeaderArr var headerRowPosition var range sheetgetRangeheaderRowPosition sheetgetLastColumn return rangegetValues[] Thêm loader Mỗi_lần load dữ liệu có_thể mất vài giây nên chúng_ta sẽ thêm loader để báo_hiệu cho người_dùng biết là dữ_liệu đang được load Chúng_ta sẽ tạo một vùng có id là loading để chèn loader
Code CSS được tham_khảo từ website httpswwwwschoolscom loading margin auto border px solid fff border-radius border-top px solid db width px height px -webkit-animation spin s linear infinite Safari animation spin s linear infinite Safari -webkit-keyframes spin -webkit-transform rotatedeg -webkit-transform rotatedeg keyframes spin transform rotatedeg transform rotatedeg Chúng_ta sẽ ẩn loader này đi khi dữ_liệu đã được tải xong function showDataTabledataTable 'loading'hide Kết_quả Như_vậy chúng_ta đã lấy_được dữ_liệu từ Google Sheets và tạo table trên web app sử_dụng Data Table jQuery plug-in
Chức_năng Search Data Tables jQuery plug-in cũng có chức_năng search build-in
Tuy_nhiên để search thì cần phải fetch toàn_bộ data giống như phần ở trên
Trong nhiều trường_hợp chúng_ta không muốn công_khai toàn_bộ dữ_liệu mà chỉ muốn người_dùng search tìm đúng thông_tin của họ
Chẳng_hạn Tra_cứu tình_trạng đơn_hàng bằng mã_vận_đơn
Tra_cứu hóa_đơn bằng mã_số hóa_đơn
Tra_cứu lịch_sử giao_dịch bằng số tài_khoản hoặc số điện_thoại
Tra_cứu thông_tin nhân_sự bằng mã nhân_viên
Chúng_ta sẽ viết_lại web và chỉ hiển_thị thông_tin theo dữ_liệu mà người_dùng search
Searchhtml File HTML này tương_tự ở trên chỉ có thêm thẻ để người_dùng nhập_nội_dung cần tìm Search your invoice Input your phone number to search your invoice Don't include country code space and other special character Search JavaScripthtml Khi người_dùng nhấn button Search sau_khi đã input dữ liệu thì client-side sẽ dùng class googlescriptrun để thực_thi hàm searchByPhoneinput ở file code Apps Script
Sau_khi return thì thêm dữ_liệu vào Data Tables instance đã khởi tạo function handleSearch remove data in the previous search if fnDataTableisDataTable'result' 'result'DataTablecleardraw 'searchBtn'attr'disabled' true get value let input documentgetElementById'searchText'value validation request server-side googlescriptrun withSuccessHandleronSuccess withFailureHandleronFailure searchByPhoneinput render response see function onSuccess function onSuccessresult if fnDataTableisDataTable'result' appendDataTable'result' resultdata else renderTable'result' result 'searchBtn'removeAttr'disabled' function appendDataTableelementSelector rowData elementSelectorDataTablerowsaddrowDatadraw function renderTableelementSelector option var table elementSelector var field [] optionheaderforEachname fieldpushtitle name tableDataTable data optiondata columns field paging false ordering true info false searching false function onFailure windowalert'Đã xảy_ra lỗi khi truy_cập file' Route Web app của chúng_ta giờ đã có trang nên viết_lại hàm doGete để thêm tham_số p function doGete var page eparameterp 'Index' return HtmlServicecreateTemplateFromFilepage evaluatefunction searchByPhoneinput var range sheetgetDataRange var data rangegetValues var header data[] var phoneCol headerindexOf'Phone' var result datafilterfunctionrow return row[phoneCol] input return header getHeaderArr data result Như_vậy chúng_ta đã xây_dựng được chức_năng search cơ_bản để hiển_thị dữ_liệu lên web app Apps Script từ Google Sheets Để hoàn_thiện chức_năng search này thì bạn có_thể thực_hiện validate search text và thêm loader để báo_hiệu trạng_thái load dữ liệu cho người_dùng biết giống phần cũng_như xử_lý lỗi trong một số tình_huống như không tìm thấy dữ_liệu người_dùng chỉnh sửa tham_số p nên không tìm thấy file
Link table web app Link search data web app Link Google Sheets file Github code Beginner web app Google Sheets Apps Script All Rights Reserved Report