httpsvibloasiaptong-quan-phan-quyen-tren-aws-identity-and-access-management-mZAjlkGTu Thien tutatthien Follow Published Sunday PM min read Tổng_quan phân_quyền trên AWS Identity and Access Management Report Dẫn_dắt AWS hiện là nhà_cung_cấp dịch_vụ cloud đi tiên_phong và đứng_đầu thị_trường cloud với hơn service
AWS cloud đã tạo_nên một hệ_sinh_thái khổng_lồ đáp_ứng hầu_hết các nhu_cầu điện_toán đám_mây với một hệ_thống sinh_thái lớn yêu_cầu khả_năng quản_trị chặt_chẽ linh_hoạt và bảo_mật Để tránh các mất_mát không_đáng có việc quản_trị truy_cập và phân_quyền là tất_yếu và vô_cùng quan_trọng khi sử_dụng cloud
Bài_viết mong_muốn đem_lại cái nhìn tổng_quan_cách AWS Identity and Access Management quản_lý phân quyên trên các tài_nguyên
Khái_niệm phân_quyền Phân_quyền là việc tạo_ra một tập_hợp các chính_sách quyết_định một chủ_thể được_phép thực_thi một hành_động trên một tài_nguyên hay không Chính_sách - policy là đơn_vị cơ_bản và quan trong nhất trong quá trính phân_quyền trong aws một hầu_hết policy có định dạng json và có các syntax và cấu_trúc được aws quy đinh củ_thể
Chủ_thể - principal bao_gồm user role federated user application
Chủ_thể gửi các request yêu_cầu thực_hiện một action trên resouce
Hành_động - action là hành_động thực_hiện trên tài_nguyên được định_nghĩa trong từng service
Tài_nguyên - resource là một đối_tượng trong service
Với aws việc phân_quyền và định danh nhằm kiểm_soát các truy_cập vào tài_nguyên từ các định danhIAM Identity trong cùng tài_khoản đảm_bảo việc các service làm_việc với_nhau an_toàn và kiểm xoát các truy_cập tài_nguyên từ ngoài tài_khoản
Bao_gồm các truy_cập định danh bên_ngoài tài_khoản và truy_cập không định danh tới các tài_nguyên công_khai Một service aws được phân_tách thành các resource và các action trên resource của service
Tham_khảo danh_sách service
Chính_sách - policy Một policy được định_nghĩa theo cấu_trúc json và bao_gồm các thuộc_tính cơ_bản Statement Mỗi_một policy đều có ít_nhất một statement statement dùng để chỉ_định action nào được thực_thi và tài_nguyên nào được truy_cập
Statement gồm các thành_phần Sid Là một_chuỗi uniq dùng để nhận_dạng statement Effect Chỉ_định các actions được liệt_kê là AlllowDeny Action Liệt_kê các hành_động bạn muốn thực_thi ecCreateImage ecCreateNetworkAcl Principal Là tài khoảnngười dùngrole được cho_phép hoặc bị từ_chối truy_cập vào tài_nguyên AWS Resource Chính là tài_nguyên AWS mà bạn muốn áp_dụng những actions bên_trên Condition Chỉ_định các điều_kiện bắt_buộc phải tuân_theo khi áp_dụng policy này dựa_trên các condition key được định_nghĩa theo từng resouce action service-specific condition key và dựa_trên các contex key global condition key Version -- Statement [ Sid Stmt Action [ elasticbeanstalkCreateApplication ] Effect Allow Resource arnawselasticbeanstalkap-southeast-applicationstaging Condition DateGreaterThan awsCurrentTime ] reference policies elements Nguồn tham_khảo AWS policy grammar Mỗi policy là tập_hợp của các các statement và mỗi statement quy_định việc DENYALLOW một hoặc nhiều action được thực_hiện trên một hoặc nhiều resource
Policy aws có_thể chỉ_định chủ_thể có hiệu_lực với quy_tắc trên statement với Principal dựa_trên cơ_chế Resource-base policy chỉ áp_dụng với một số resource
IAM Identity IAM Identities users groups and roles là đối_tượng chính được phân_quyền và sử_dụng phân_quyền thực_hiện các hành động  AWS account root user root user được tạo khi bạn tạo một account nó có_quyền cao nhất trong account không_thể bị xoá và chỉnh sửa phân_quyền
Root user chỉ nên được sử_dụng các tác_vụ riêng_biệt
Aws khuyên cáo không_nên sử_dụng root user tạo các credentials và không_nên sử_dụng aws account root user cho các hoạt_động thông thườngaws tasks-that-require-root IAM users là một chủ_thể được người_dùng tạo trong aws và được sử_dụng để đại_diện cho một người hoặc một service tương_tác với AWS
IAM user có_thể được xác_thực bằng name và password hoặc sử_dụng với aws api aws cli bằng các credentials được tạo
IAM groups là một đại_diện cho tập_hợp các user Được sử_dụng để phân quyên cho một nhóm các user có chung một nhóm các policy
Một group được phân quyên giống như các user dựa_trên các policy được gắn và các user trong group cũng sẽ được áp_dụng chung các chính_sách trong policy
Nhớ đó dễ_dàng quản_lý phân quyên cho từng nhóm người_dùng trong aws account
IAM roles tương_tự như các user được gắn các policy để phân_quyền nhưng thay_vì đại_diên cho người
Role có_thể được sử_dụng để ủy quyền cho một principal không_thể chỉ_định Đặc_điểm Không có long-term credentials hoặc name password cho_phép bạn truy_cập aws Được sử_dụng để cấp quyền tạm_thời cho các application user service trước_đó không có quyền truy_cập Iam role có_thể cấp quyền truy_cập tạm_thời cho các service quyền truy_cập resource của service khác aws service role hoặc uỷ_quyền truy_cập cho service khác aws service-linked role AWS service role for an EC instance Cơ_chế trust police là resource-based police cho_phép chỉnh định principal được_phép sử_dụng role
Temporary credentials in IAM là một giấy_phép tạm_thời được sử_dụng cho các tác_vụ ngắn_hạn các giấy_phép tạm_thời có_quyền truy_cập dựa_trên IAM Identity được chỉ_định user hoặc role
Chính_sách và phân_quyền trong IAM Trong aws người_dùng kiểm_soát phân_quyền bằng cách tạo_ra chính_sách - policies và gắn chúng với IAM identities users groups of users or roles hoặc AWS resources
Tập_hợp các policy có hiệu_lực trên chủ_thể và trên resouce quyết_định kết_quả phân_quyền ALLOW hoặc DENY Policy Type Để đáp_ứng các nhu cấu phân_quyền cho các định danh các resource kiểm_soát quyền của các định danh IAM Identity và xác đinh quyền truy_cập của các account trong Origanizations
Aws sử_dụng nhiều policy type cho từng mục_đích khác_nhau
Identity-based policies – json policy permission các chính_sách dựa_trên danh_tính được sử_dụng để phân_quyền cho các Identity user role group
Có định dạng JSON và được quản_lý theo nhóm Managed policies là các chính_sách độc_lập bạn có_thể sử_dụng cho nhiều Identity Được chia thành loại AWS managed policies các chính_sách do aws tạo và quản_lý
Customer managed policies các chính_sách do người_dùng tạo và quản_lý Inline policies các chính_sách do người_dùng tạo và chị được gắn với một Identity duy_nhất và sẽ bị xoá khi identity bị_xoá
Hướng_dẫn sử_dụng indentity-based policy Resource-based policies – json policy permission là một inline policy được gắn với resource một resource-based policies quy_định các principal được áp_dụng chính_sách và sử_dụng condition để kiểm_soát truy_cập
Nó cho_phép các principal ngoài account sử_dụng các tài_nguyên trong account Đặc_điểm Khi resource-based policy chỉ_định principal là một principal của một account khác principal vẫn cần được cấp_phép sử_dụng các resource bởi Identity-based policy của account sở_hữa principal tham_khảo ví_dụ IAM có loại resource-based policy là trust role policy được gắn cho IAM role cho_phép role chỉ_định Trusted entities và thực_hiện cross-account access
IAM roles và resource-based policy vẫn có sự_khác_biệt trong cơ_chế ủy quyền cross-account access tham_khảo thêm Permissions boundaries – json policy permission là một managed policy được sử_dụng cho role và user nhằm hạn_chế giới_hạn phân_quyền tối_đa các chủ_thể có_thể thực hiệnĐặc điểm Các user hoặc role không_thể thực_hiện các yêu_cầu vi_phạm policies mà Permissions boundaries quy_định
Resource-based policy không bị giới_hạn bởi Permissions boundaries Permissions boundaries không cấp quyền cho chủ_thể Organizations SCPs – json policy permission Sử_dụng AWS Organizations service control policy SCP để định_nghĩa phân_quyền tối_đa cho các account members của một organization hoặc organization unit ou
Tương_tự Permissions boundaries không cấp quyền cho chủ_thể Đặc điểm Không ảnh_hưởng tới các principal ngoài account trong resource-based policy Không hạn_chế quyền của user và role trong management account SCP áp_dụng cho tất_cả user role bao_gồm các root user thuộc các account được thêm_vào aws Organizations hoặc ou SCP không áp_dụng cho các service-linked role Access control lists ACLs được sử_dụng để cho_phép thực_hiện cross-account access acl chỉ_định các principals của các account khác để kiểm_soát truy_cập
ACL không sử_dụng đinh dạng JSON policy acl không_thể sử_dụng với các principals trong cùng account
Session policies – json policy permission được sử_dụng cho các temporary cendentials hoặc feradated user nhằm cấp quyền truy_cập cho các định danh tạm_thời dựa_trên Identity-based policy được áp_dụng
Có_thể hiểu nếu một temporary cendentials không_được cấp quyền bởi một session policy sẽ bị từ_chối hành_động hoặc nếu request được chấp_thuận bởi session policy nhưng không_được cấp quyền bởi Identity-based policy sẽ bị từ_chối
Nếu chia tách theo mục đính sử_dụng ta sẽ có Identity-based policy Session policy Resource-based policy là các chính_sách cấp_quyền
Với Permission boundaries Organization SCPs là các chính_sách hạn_chế quyền truy_cập
Policy evaluation logic Khi một principal thực_hiện một request thông_qua aws api aws cli aws management console một request được gửi đến aws và được sử lý theo các bước Authentication - principal được xác_thực danh_tính
Trong mốt số trường_hợp với số service như s cho truy_cập từ các anonymous user không_cần xác_thực danh_tính
Processing the request context - aws sử_lý thông_tin trong request và xác_định các policy được áp_dụng Evaluating policies within a single account - aws tổng_hợp tất_cả policy theo policy type điều này ảnh_hưởng đến thứ_tự ưa tiên trong đánh_giá policy Determining whether a request is allowed or denied within an account - aws sẽ xác_định request được cho_phép hay từ_chối dựa_trên policy đã được tổng_hợp và request context Quy_trình đánh_giá request ALLOWDENY trong account Được aws chia thành bước đánh_giá dựa_trên phân_loại policy Deny evaluation bất_cứ Deny statement nào trong policy từ bất cư policy type được tổng_hợp và đánh_giá đầu_tiên
Nếu Deny statement được áp_dụng request sẽ bị từ_chối Oraganizations policy Nếu principal thuộc một account được áp_dụng Organization policy từ SCP request phải tuân_thủ policy từ Oraganization policy nếu không sẽ bị từ_chối
Ngay cả khi request đến từ aws account root user vẫn sẽ phải được cấp quyền từ Oraganization policy
Resource-based policy Nếu policy từ Resource-based policy chấp_thuận request request sẽ được chấp_thuận ngay_lập_tức
IAM permission boundaries nếu principal được áp_dụng permission boundaries và request không_được cấp_phép bởi các policy trong IAM permission boundaries request sẽ bị từ_chối session policy nếu principal là một temporary credentials nó phải tuân_thủ session policy nếu không sẽ bị từ_chối truy_cập
Identity-based policy nếu principal không_được áp_dụng resource-based policy thì nó bắt_buộc phải được cấp quyền bởi Identity-based policy để_được thự Quy_trình đánh_giá request ALLOWDENY trong cross-account Việc truy_cập tài_nguyên bằng định danh thuộc một account khác yêu_cầu sự_cho_phép từ một resource-based policy được chỉ_định bởi resource cần truy_cập
Quá_trình đánh_giá yêu_cầu các bước Tổng_hợp Identity-based policy được áp_dụng với principal từ Trusted AccountA và xác_nhận quyền truy_cập từ các policy được áp_dụng
Nếu request được chấp_thuận trong Trusted AccountA sẽ được gửi đến Trusting AccountB sẽ tiếp_tục được xác_nhận bởi các resource-based policy được áp_dụng nên resource
Nếu được chấp_thuận request sẽ được thực_hiện
Authorization strategy Với aws IAM cho_phép bạn thực_hiện chiến_lược phân_quyền Attribute-based access control ABAC và role-based access control RBAC
Trong_đó RBAC phân_quyền dựa_trên vai_trò là cách_thức phân_quyền theo đó bạn tạo_ra các phân quyên theo vai_trò người_sử_dụng Dev Database admin
Trong IAM việc này tương_đương với tạo_ra các policy và gắn với các định danh Điều này giúp cấp tối_thiểu các đặc_quyền cho người_sử_dụng ABAC phân_quyền dưa trên thuộc_tính theo đó các chính_sách định_nghĩa phân_quyền dựa_trên thuộc_tính của tài_nguyên và của người_sử_dụng
Từ_đó đạt được sự_linh_hoạt và kiểm_soát dễ_dàng các phân_quyền
Trong IAM ABAC được sử_dụng dựa_trên các tag được gắn với các resource và Identity để dễ_dàng phân_quyền theo nhóm các tài_nguyên và nhóm định danh
Tổng_kết Bài_viết đưa_ra các khái_niệm cơ_bản mà mọi_người cần lắm được để có_thể sử_dụng IAM AWS chi_tiết bạn_đọc có_thể tham_khảo các tài_liệu được đính_kèm trong bài_viết
Phần_lớn bài_viết được dịch từ tài_liệu của aws và một_vài nhận_biết cá_nhân lên có_thể có sai_lầm nên mong được bạn_đọc góp_ý để hoàn_thiện bài_viết mình trân_trọng cám_ơn mọi đóng_góp xây_dựng
AWS Identity and Access Management policy Permission Amazon Web Services AWS iam All Rights Reserved Report